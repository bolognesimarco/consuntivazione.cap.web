<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Insert title here</title>
<script src="js/jquery-1.11.1.js"></script>
<style>
	.mt{
		display: table;
		border: solid 1px red;
	}
		.mt_headerrow{
			display: table-row;
		}
			.mt_headerrow_left{
				display: table-cell;
				width: 100px;
				border: solid 1px magenta;
			}
			.mt_headerrow_center{
				display: table-cell;
				overflow-x: hidden;
				width: 400px;
				border: solid 1px orange;
			}
				.mt_headerrow_center_table{
					display: table;
				}
					.mt_headerrow_center_table_row{
						display: table-row;
					}
						.mt_headerrow_center_table_row_cell{
							display: table-cell;
							width: 200px;
						}
			.mt_headerrow_right{
				display: table-cell;
				width: 100px;
				border: solid 1px black;
			}
		.mt_contentrow{
			display: table-row;
		}
			.mt_contentrow_left{
				display: table-cell;
				overflow-y: hidden;
				width: 100px;
				border: solid 1px magenta;
			}
				.mt_contentrow_left_table{
					display: table;
					width: 100px;
				}
					.mt_contentrow_left_table_row{
						display: table-row;
						width: 100px;
					}
						.mt_contentrow_left_table_row_cell{
							display: table-cell;
							width: 100px;
							height: 70px;
						}
			.mt_contentrow_center{
				display: table-cell;
				overflow: hidden;
				width: 400px;
				border: solid 1px orange;
			}
				.mt_contentrow_center_table{
					display: table;
				}
					.mt_contentrow_center_table_row{
						display: table-row;
					}
						.mt_contentrow_center_table_row_cell{
							display: table-cell;
							width: 200px;
							height: 70px;
						}
			.mt_contentrow_right{
				display: table-cell;
				overflow-y: scroll;
				width: 100px;
				border: solid 1px black;
			}
				.mt_contentrow_right_table{
					display: table;
				}
					.mt_contentrow_right_table_row{
						display: table-row;
					}
						.mt_contentrow_right_table_row_cell{
							display: table-cell;
							width: 100px;
							height: 70px;
						}
		.mt_footerrow{
			display: table-row;
		}
			.mt_footerrow_left{
				display: table-cell;
				width: 100px;
				border: solid 1px magenta;
			}
			.mt_footerrow_center{
				display: table-cell;
				overflow-x: scroll;
				width: 400px;
				border: solid 1px orange;
			}
			.mt_footerrow_right{
				display: table-cell;
				width: 100px;
				border: solid 1px black;
			}
</style>
</head>
<body>
<script type="text/javascript">
var reportentries = [
{"id":1,"days":13.5,"invoice":{"id":10, "date":1234567890},"timeSheet":{"id":21,"endDate":1409436000000,"days":2.5,"suspendedDays":10},"order": {"id":41, "leftDays":2, "rate":310.00, "worker":{"name":"Bolognesi"}}},
{"id":2,"days":3.5,"invoice":{"id":11, "date":1234567890},"timeSheet":{"id":22,"endDate":1406757600000,"days":3.5,"suspendedDays":10},"order": {"id":41, "leftDays":2, "rate":310.00, "worker":{"name":"Bolognesi"}}},
{"id":3,"days":1.5,"invoice":{"id":12, "date":1234567890},"timeSheet":{"id":23,"endDate":1412028000000,"days":1.5,"suspendedDays":10},"order": {"id":41, "leftDays":2, "rate":310.00, "worker":{"name":"Bolognesi"}}},
{"id":4,"days":23.5,"invoice":{"id":31, "date":1234567890},"timeSheet":{"id":34,"endDate":1409436000000,"days":4.5,"suspendedDays":10},"order": {"id":42, "leftDays":2, "rate":310.00, "worker":{"name":"Bruni"}}},
{"id":5,"days":10.5,"invoice":{"id":14, "date":1234567890},"timeSheet":{"id":24,"endDate":1406757600000,"days":6.5,"suspendedDays":10},"order": {"id":43, "leftDays":2, "rate":310.00, "worker":{"name":"Gnignera"}}},
{"id":6,"days":4.5,"invoice":{"id":15, "date":1234567890},"timeSheet":{"id":24,"endDate":1412028000000,"days":7.5,"suspendedDays":10},"order": {"id":44, "leftDays":2, "rate":310.00, "worker":{"name":"Barigelli"}}},
{"id":7,"days":6.5,"invoice":{"id":16, "date":1234567890},"timeSheet":{"id":24,"endDate":1409436000000,"days":2.5,"suspendedDays":10},"order": {"id":45, "leftDays":2, "rate":310.00, "worker":{"name":"Bruni"}}},
{"id":8,"days":2.5,"invoice":{"id":17, "date":1234567890},"timeSheet":{"id":21,"endDate":1406757600000,"days":4.5,"suspendedDays":10},"order": {"id":45, "leftDays":2, "rate":310.00, "worker":{"name":"Bruni"}}},
{"id":9,"days":22.5,"invoice":{"id":18, "date":1234567890},"timeSheet":{"id":12,"endDate":1412028000000,"days":5.5,"suspendedDays":10},"order": {"id":46, "leftDays":2, "rate":310.00, "worker":{"name":"Bolognesi"}}}
];
var mesiDesc = ['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'];

function reportSorter(a,b){
	if(a.order.id==b.order.id){ 
		return a.timeSheet.endDate-b.timeSheet.endDate;
	}else{
		return a.order.id-b.order.id;
	}
}

function reportdiv(divcontent){
	var div = $(document.createElement('div'));
	var table = $(document.createElement('table'));
	var rowgiorni = $(document.createElement('tr'));
	rowgiorni.append($(document.createElement('td')).text("Giorni:"));
	rowgiorni.append($(document.createElement('td')).text(divcontent.days));
	var roweuro = $(document.createElement('tr'));
	var tdeuro = $(document.createElement('td')).text("Euro:");
	tdeuro.attr('class','label');
	roweuro.append(tdeuro);
	
	roweuro.append($(document.createElement('td')).text((divcontent.days*divcontent.order.rate)));
	var rowinvoice = $(document.createElement('tr'));
	rowinvoice.append($(document.createElement('td')).text("Fattura"));
	if(divcontent.invoice!=null){
		rowinvoice.append($(document.createElement('td')).text(divcontent.invoice.id+" del "+divcontent.invoice.date));
	}else{
		var checkbox = $(document.createElement('input'));
		checkbox.attr('type','checkbox');
		checkbox.attr('name','toinvoice');
		checkbox.attr('value',divcontent.id);
		rowinvoice.append($(document.createElement('td')).append(checkbox));
	}
	
	table.append(rowgiorni);
	table.append(roweuro);
	table.append(rowinvoice);
	div.append(table);
	return div;
}

(function ( $ ) {
	$.fn.miotable = function(data, options){

		var settings = $.extend({
			
		}, options);
		
		var mt = $(document.createElement('div'));
		mt.attr('class','mt');
		
			var mt_headerrow = $(document.createElement('div'));
			mt_headerrow.attr('class','mt_headerrow');
			mt.append(mt_headerrow);
				var mt_headerrow_left = $(document.createElement('div'));
				mt_headerrow_left.attr('class','mt_headerrow_left');
				mt_headerrow_left.text('XXX');
				mt_headerrow.append(mt_headerrow_left);
				var mt_headerrow_center = $(document.createElement('div'));
				mt_headerrow_center.attr('class','mt_headerrow_center');
				mt_headerrow.append(mt_headerrow_center);
					var mt_headerrow_center_table = $(document.createElement('div'));
					mt_headerrow_center_table.attr('class','mt_headerrow_center_table');
					mt_headerrow_center.append(mt_headerrow_center_table);
						var mt_headerrow_center_table_row = $(document.createElement('div'));
						mt_headerrow_center_table_row.attr('class','mt_headerrow_center_table_row');
						mt_headerrow_center_table.append(mt_headerrow_center_table_row);
				var mt_headerrow_right = $(document.createElement('div'));
				mt_headerrow_right.attr('class','mt_headerrow_right');
				mt_headerrow_right.text('XXX');
				mt_headerrow.append(mt_headerrow_right);

			var mt_contentrow = $(document.createElement('div'));
			mt_contentrow.attr('class','mt_contentrow');
			mt.append(mt_contentrow);
				var mt_contentrow_left = $(document.createElement('div'));
				mt_contentrow_left.attr('class','mt_contentrow_left');
				mt_contentrow.append(mt_contentrow_left);
					var mt_contentrow_left_table = $(document.createElement('div'));
					mt_contentrow_left_table.attr('class','mt_contentrow_left_table');
					mt_contentrow_left.append(mt_contentrow_left_table);
				var mt_contentrow_center = $(document.createElement('div'));
				mt_contentrow_center.attr('class','mt_contentrow_center');
					var mt_contentrow_center_table = $(document.createElement('div'));
					mt_contentrow_center_table.attr('class','mt_contentrow_center_table');
					mt_contentrow_center.append(mt_contentrow_center_table);
				mt_contentrow.append(mt_contentrow_center);
				var mt_contentrow_right = $(document.createElement('div'));
				mt_contentrow_right.attr('class','mt_contentrow_right');
					var mt_contentrow_right_table = $(document.createElement('div'));
					mt_contentrow_right_table.attr('class','mt_contentrow_right_table');
					mt_contentrow_right.append(mt_contentrow_right_table);
				mt_contentrow.append(mt_contentrow_right);
				
			var mt_footerrow = $(document.createElement('div')); 
			mt_footerrow.attr('class','mt_footerrow');
			mt.append(mt_footerrow);
				var mt_footerrow_left = $(document.createElement('div'));
				mt_footerrow_left.attr('class','mt_footerrow_left');
				mt_footerrow_left.text("ZZZ");
				mt_footerrow.append(mt_footerrow_left);
				var mt_footerrow_center = $(document.createElement('div'));
				mt_footerrow_center.attr('class','mt_footerrow_center');
				mt_footerrow_center.text("ZZZ");
				mt_footerrow.append(mt_footerrow_center);
				var mt_footerrow_right = $(document.createElement('div'));
				mt_footerrow_right.attr('class','mt_footerrow_right');
				mt_footerrow_right.text("ZZZ");
				mt_footerrow.append(mt_footerrow_right);
				
				
				
				var ordiniid = [];
				var ordini = [];
				var mesi = [];
				data.sort(reportSorter);
				
				$.each(data, function() {
					
					if($.inArray(this.order.id, ordiniid)==-1){	
						ordiniid.push(this.order.id);
						ordini.push(this.order);
					}
					if($.inArray(this.timeSheet.endDate, mesi)==-1){
						mesi.push(this.timeSheet.endDate);
					}
				});
				mesi.sort();
				
				
				
				$.each(mesi, function(i,v){
					var data = new Date(v);
					var divmese = $(document.createElement('div'));
					divmese.attr('class','mt_headerrow_center_table_row_cell')
					divmese.text(mesiDesc[data.getMonth()]+'-'+(data.getYear()+1900));
					mt_headerrow_center_table_row.append(divmese);
				});
				
				
				
				
				$.each(ordini, function(i,v){
					/* var newrow = $(document.createElement('tr'));
					var rowheader = $(document.createElement('td')); */
					var mt_contentrow_left_table_row = $(document.createElement('div'));
					mt_contentrow_left_table_row.attr('class','mt_contentrow_left_table_row');
					mt_contentrow_left_table.append(mt_contentrow_left_table_row);
						var mt_contentrow_left_table_row_cell = $(document.createElement('div'));
						mt_contentrow_left_table_row_cell.attr('class','mt_contentrow_left_table_row_cell');
						mt_contentrow_left_table_row.append(mt_contentrow_left_table_row_cell);
						mt_contentrow_left_table_row_cell.text(v.worker.name+' '+v.id);

					var mt_contentrow_center_table_row = $(document.createElement('div'));
					mt_contentrow_center_table_row.attr('class','mt_contentrow_center_table_row');
					mt_contentrow_center_table.append(mt_contentrow_center_table_row);
					var reportentryordine = true;
					while(reportentryordine && data.length>0){
						if(data[0].order.id==v.id){
							$.each(mesi, function(im,vm){
								if(data.length>0 && data[0].timeSheet.endDate==vm && data[0].order.id==v.id){
									var mt_contentrow_center_table_row_cell = $(document.createElement('div'));
									mt_contentrow_center_table_row_cell.attr('class','mt_contentrow_center_table_row_cell');
									mt_contentrow_center_table_row_cell.append(reportdiv(data[0]));
									mt_contentrow_center_table_row.append(mt_contentrow_center_table_row_cell);
									data.shift();
								}else{
									var mt_contentrow_center_table_row_cell = $(document.createElement('div'));
									mt_contentrow_center_table_row_cell.attr('class','mt_contentrow_center_table_row_cell');
									mt_contentrow_center_table_row.append(mt_contentrow_center_table_row_cell);
								}
							});
							
						}else{
							reportentryordine=false;
						}
					}
					
					/*
					var residuo = $(document.createElement('td')).text(v.leftDays);
					mt_contentrow_left_table_row.append(residuo);
					*/
				});
				
				
				
				
		this.append(mt);
	};
}(jQuery));

$(document).ready(function(){
	$("#miotablecontainer").miotable(reportentries);
});

</script>
	<div id="miotablecontainer"></div>
</body>
</html>